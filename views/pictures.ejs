<!DOCTYPE html>
<html>

<head>
    <% include partials/head.ejs %>
</head>

<body id=" <%= pageID %>">
    <script src="exif.js"></script>
    <script src="fraction.js"></script>
    <script>
        function getExif(){
            EXIF.getData(event.target, function() {
                console.log(EXIF.getAllTags(this));
                let model = EXIF.getTag(this, "Model");
                let focalLength = EXIF.getTag(this, "FocalLength");
                let shutterSpeed = EXIF.getTag(this, "ExposureTime");
                let aperture = EXIF.getTag(this, "FNumber");
                let iso = EXIF.getTag(this, "ISOSpeedRatings");
                let exposureBias = EXIF.getTag(this, "ExposureBias");
                let description = EXIF.getTag(this, "ImageDescription");
                let id="h5-"+this.id;
                let id2="comment-"+this.id;

                document.getElementById(id2).innerHTML=description;
                document.getElementById(id).innerHTML="<div class='datacontainer'> <span class = 'dataitem'><b>Camera:</b> "+model+"</span>"+
                    "<span class = 'dataitem'><b>Focal Length:</b> "+focalLength.numerator/focalLength.denominator+" mm"+"</span>"+
                    "<span class = 'dataitem'><b>Shutter Speed:</b> "+new Fraction(shutterSpeed.numerator,shutterSpeed.denominator)+" sec"+"</span>"+
                    "<span class = 'dataitem'><b>Aperture:</b> f/"+aperture.numerator/aperture.denominator+"</span>"+
                    "<span class = 'dataitem'><b>ISO:</b> "+iso+"</span>"+
                    "<span class = 'dataitem'><b>Exposure Bias:</b> "+exposureBias.toPrecision(2);"</span></div>"   
            });
        }
    </script>

    <% include partials/header.ejs %>
    <% include partials/pagenav.ejs %>

    <!-- <% console.log("pics in render",pics); %> -->

    <div class="container">
        <% pics.forEach( pic => { %>
            <% console.log(pic.file + ' exif data: ',pic.exif); %>
            <div class='panel panel-default'>
                <% let stripText = '/images/' + genre + '/' %>
                <% let name = pic.path.replace(stripText,'') %>
                <div class="panel-body">

                    <b><h5 id="comment-<%=name%>"><%=pic.desc%></h5></b>
                    <div class="shadowinset">
                        <!-- <img src="<%=pic.path%>" alt="" class="img-responsive centered" id="<%=name%>" onload="getExif()"> -->
                        <img src="<%=pic.path%>" alt="" class="img-responsive centered" id="<%=name%>">
                    </div>
                    <h5 id="h5-<%=name%>">

                        <div class='datacontainer'> <span class = 'dataitem'><b>Camera:</b> <%=pic.camera%></span>
                            <span class = 'dataitem'><b>Focal Length:</b> <%=pic.focalLength%> mm</span>
                            <span class = 'dataitem'><b>Shutter Speed:</b> <%=pic.shutterSpeed%> sec</span>
                            <span class = 'dataitem'><b>Aperture:</b> f/<%=pic.aperture%></span>
                            <span class = 'dataitem'><b>ISO:</b> <%=pic.iso%></span>
                            <span class = 'dataitem'><b>Exposure Bias:</b> <%=pic.exposureBias%></span>
                        </div>

                    </h5>

                </div>
            </div>
        <% }) %>
    </div>

    <% include partials/pagenav.ejs %>
    <% include partials/footer.ejs %>

</body>

</html>